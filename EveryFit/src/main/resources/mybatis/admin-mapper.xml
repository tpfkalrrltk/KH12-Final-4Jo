<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin">

	<select id="adminMemberList" resultType="MemberDto">
		select * from member
		order by member_email asc
	</select>

	<select id="adminMemberTarget" resultType="MemberDto">
		select* from member
		where member_email = #{memberEmail}
	</select>



	<!-- 회원 복합 검색 -->

	<select id="adminMemberSearch" resultType="MemberDto">

		<!-- <include refid="pagingHeader"></include> -->

		select * from member
		<where>

			<if test="memberEmail != null">
				and instr(member_email, #{memberEmail}) > 0
			</if>

			<if test="memberName !=null">
				and instr(member_name, #{memberName}) > 0
			</if>

			<if test="memberNick != null">
				and instr(member_nick,#{memberNick}) >0
			</if>

			<if test="memberContact != null">
				and instr(member_contact, #{memberContact})>0
			</if>

			<choose>

				<when
					test="memberBirthBegin != null and memberBirthEnd != null">
					and to_date(member_birth, 'YYYY-MM-DD') between
					to_date(#{memberBirthBegin} || ' ' ||'00:00:00','YYYY-MM-DD
					HH24:MI:SS')
					and
					to_date(#{memberBirthEnd} || ' ' ||'23:59:59',
					'YYYY-MM-DD HH:24:MI:SS')
				</when>
				<when test="memberBirthBegin != null">
<![CDATA[
and to_date(member_birth, 'YYYY-MM-DD') >= 
to_date(#{memberBirthBegin} || ' ' ||'00:00:00','YYYY-MM-DD HH24:MI:SS')
]]>
				</when>
				<when test="memberBirthEnd != null">
<![CDATA[
and to_date(member_birth, 'YYYY-MM-DD') <=
to_date(#{memberBirthEnd} || ' ' || '23:59:59', 'YYYY-MM-DD HH24:MI:SS')
]]>
				</when>
			</choose>

			<if test="memberGenderList != null and memberGenderList.size() >0">
				and member_gender in
				<foreach collection="memberGenderList" open="(" close=")"
					separator="," item="Gender">
					#{Gender}
				</foreach>
			</if>

			<if test="memberLevelList != null and memberLevelList.size()>0">
				and member_level in
				<foreach collection="memberLevelList" open="(" close=")"
					separator="," item="Level">
					#{Level}
				</foreach>
			</if>


		</where>

		<!-- 정렬 -->
		<if test="orderList != null  and  orderList.size() >0">
			order by
			<foreach collection="orderList" separator="," item="order">
				${order}
			</foreach>
		</if>

	</select>


	<!-- 모임 목록 -->
	<select id="adminMoimList" resultType="MoimDto">
		select * from moim
		order by
		moim_no asc
	</select>


	<!-- 모임 복합 검색 -->
	<select id="adminMoimSearch" resultType="MoimDto">
		select * from moim

		<where>
			<if test="moimNo !=null">
				and instr(moim_no, #{moimNo})>0
			</if>
			<if test="moimTitle  !=null">
				and instr(moim_title, #{moimTitle})>0
			</if>
			<if test="moimMemberCount  !=null">
				and instr(moim_member_count, #{moimMemberCount})>0
			</if>

			<choose>
				<when test="moimTimeStart != null and moimTimeEnd !=null ">
					and to_date(moim_time, 'YYYY-MM-DD') between
					to_date(#{moimTimeStart} || ' ' || '00:00:00' 'YYYY-MM-DD
					HH24:MI:SS') and
					to_date(#{moimTimeEnd} || ' ' || '23:59:59'
					'YYYY-MM-DD HH24:MI:SS')
				</when>
				<when test="moimTimeStart != null">
				<![CDATA[	
				and to_date(moim_time, 'YYYY-MM-DD') >= 
				to_date(#{moimTimeStart} || ' ' ||'00:00:00' 'YYYY-MM-DD HH24:MI:SS')
				]]>
				</when>
				<when test="moimTimeEnd !=null">
				<![CDATA[
				and to_date(moim_time, 'YYYY-MM-DD') <=
				to_date(#{moimTimeEnd} || ' ' || '23:59:59' 'YYYY-MM-DD HH24:MI:SS')
				]]>
				</when>

			</choose>

			<if test=" moimUpgradeList !=null and moimUpgradeList.size() >0">
				and moim_upgrade in
				<foreach collection="moimUpgradeList" open="(" close=")"
					separator="," item="UpgradeList">
					${UpgradeList}
				</foreach>
			</if>

			<if
				test="moimGenderCheckList != null and moimGenderCheckList.size() >0">
				and moim_gender_check in
				<foreach collection="moimGenderCheckList" open="(" close=")"
					separator="," item="GenderList">
					${GenderList}
				</foreach>
			</if>
			<if test="moimStateList !=null and moimStateList.size()>0">
				and moim_state in
				<foreach collection="moimStateList" open="(" close=")"
					separator="," item="StateList">
					${StateList}
				</foreach>
			</if>
		</where>


		<if test="orderList !=null and orderList.size()>0">
			order by
			<foreach collection="orderList" separator="," item="order">
				${order}
			</foreach>
		</if>



	</select>



</mapper>